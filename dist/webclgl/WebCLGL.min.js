!function(){function e(t,r,i){function l(a,s){if(!r[a]){if(!t[a]){var o="function"==typeof require&&require;if(!s&&o)return o(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[a]={exports:{}};t[a][0].call(f.exports,function(e){var r=t[a][1][e];return l(r||e)},f,f.exports,e,t,r,i)}return r[a].exports}for(var n="function"==typeof require&&require,a=0;a<i.length;a++)l(i[a]);return l}return e}()({1:[function(e,t,r){(function(i){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGL=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e("./WebCLGLBuffer.class"),s=e("./WebCLGLKernel.class"),o=e("./WebCLGLVertexFragmentProgram.class"),u=e("./WebCLGLUtils.class"),f=r.WebCLGL=function(){function e(t){l(this,e),this.utils=new u.WebCLGLUtils,this._gl=null,this.e=null,void 0===t||null===t?(this.e=document.createElement("canvas"),this.e.width=32,this.e.height=32,this._gl=u.WebCLGLUtils.getWebGLContextFromCanvas(this.e,{antialias:!1})):this._gl=t,this._arrExt={OES_texture_float:null,OES_texture_float_linear:null,OES_element_index_uint:null,WEBGL_draw_buffers:null};for(var r in this._arrExt)this._arrExt[r]=this._gl.getExtension(r),null==this._arrExt[r]&&console.error("extension "+r+" not available");this._maxDrawBuffers=null,this._arrExt.hasOwnProperty("WEBGL_draw_buffers")&&null!=this._arrExt.WEBGL_draw_buffers?(this._maxDrawBuffers=this._gl.getParameter(this._arrExt.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL),console.log("Max draw buffers: "+this._maxDrawBuffers)):console.log("Max draw buffers: 1");var i=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this.precision=0!==i.precision?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n",this._currentTextureUnit=0,this._bufferWidth=0;var n=this.utils.loadQuad(void 0,1,1);this.vertexBuffer_QUAD=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(n.vertexArray),this._gl.STATIC_DRAW),this.indexBuffer_QUAD=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(n.indexArray),this._gl.STATIC_DRAW),this.arrayCopyTex=[];var a=this.precision+"attribute vec3 aVertexPosition;\nvarying vec2 vCoord;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nvCoord = aVertexPosition.xy*0.5+0.5;\n}\n",s=this.precision+"uniform sampler2D sampler_buffer;\nvarying vec2 vCoord;\nvoid main(void) {\ngl_FragColor = texture2D(sampler_buffer, vCoord);}\n";this.shader_readpixels=this._gl.createProgram(),this.utils.createShader(this._gl,"CLGLREADPIXELS",a,s,this.shader_readpixels),this.attr_VertexPos=this._gl.getAttribLocation(this.shader_readpixels,"aVertexPosition"),this.sampler_buffer=this._gl.getUniformLocation(this.shader_readpixels,"sampler_buffer");var o=function(){return void 0!==this._maxDrawBuffers&&null!==this._maxDrawBuffers?"#extension GL_EXT_draw_buffers : require\n":""}.bind(this),f=(function(){for(var e="",t=0,r=this._maxDrawBuffers;t<r;t++)e+="layout(location = "+t+") out vec4 outCol"+t+";\n";return e}.bind(this),function(){for(var e="",t=0,r=this._maxDrawBuffers;t<r;t++)e+="gl_FragData["+t+"] = texture2D(uArrayCT["+t+"], vCoord);\n";return e}.bind(this));a=this.precision+"attribute vec3 aVertexPosition;\nvarying vec2 vCoord;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nvCoord = aVertexPosition.xy*0.5+0.5;\n}",s=o()+this.precision+"uniform sampler2D uArrayCT["+this._maxDrawBuffers+"];\nvarying vec2 vCoord;\nvoid main(void) {\n"+f()+"}",this.shader_copyTexture=this._gl.createProgram(),this.utils.createShader(this._gl,"CLGLCOPYTEXTURE",a,s,this.shader_copyTexture),this.attr_copyTexture_pos=this._gl.getAttribLocation(this.shader_copyTexture,"aVertexPosition");for(var h=0,_=this._maxDrawBuffers;h<_;h++)this.arrayCopyTex[h]=this._gl.getUniformLocation(this.shader_copyTexture,"uArrayCT["+h+"]");this.textureDataAux=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,2,2,0,this._gl.RGBA,this._gl.FLOAT,new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1,1,1,1,1])),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,null)}return n(e,[{key:"getContext",value:function(){return this._gl}},{key:"getMaxDrawBuffers",value:function(){return this._maxDrawBuffers}},{key:"checkFramebufferStatus",value:function(){var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER),t={};return t[this._gl.FRAMEBUFFER_COMPLETE]=!0,t[this._gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT: The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete",t[this._gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT: There is no attachment",t[this._gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS: Height and width of the attachment are not the same",t[this._gl.FRAMEBUFFER_UNSUPPORTED]="FRAMEBUFFER_UNSUPPORTED: The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer",!0===t[e]&&null!==t[e]||(console.log(t[e]),!1)}},{key:"copy",value:function(e,t){if(void 0!==t&&null!==t)if(void 0!==t[0]&&null!==t[0]){this._gl.viewport(0,0,t[0].W,t[0].H),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,t[0].fBuffer);for(var r=[],i=0,l=t.length;i<l;i++)void 0!==t[i]&&null!==t[i]?(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+i+"_WEBGL"],this._gl.TEXTURE_2D,t[i].textureData,0),r[i]=this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+i+"_WEBGL"]):r[i]=this._gl.NONE;if(this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(r),!0===this.checkFramebufferStatus()){this._gl.useProgram(this.shader_copyTexture);for(var n=0,a=t.length;n<a;n++)this._gl.activeTexture(this._gl["TEXTURE"+n]),void 0!==t[n]&&null!==t[n]?this._gl.bindTexture(this._gl.TEXTURE_2D,t[n].textureDataTemp):this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux),this._gl.uniform1i(this.arrayCopyTex[n],n);this.copyNow(t)}}else this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);else this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}},{key:"copyNow",value:function(e){this._gl.enableVertexAttribArray(this.attr_copyTexture_pos),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.vertexAttribPointer(this.attr_copyTexture_pos,3,this._gl.FLOAT,!1,0,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0)}},{key:"createBuffer",value:function(e,t,r){return new a.WebCLGLBuffer(this._gl,e,t,r)}},{key:"createKernel",value:function(e,t){return new s.WebCLGLKernel(this._gl,e,t)}},{key:"createVertexFragmentProgram",value:function(e,t,r,i){return new o.WebCLGLVertexFragmentProgram(this._gl,e,t,r,i)}},{key:"fillBuffer",value:function(e,t,r){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,r),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL,this._gl.TEXTURE_2D,e,0);var i=[this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(i),void 0!==t&&null!==t&&this._gl.clearColor(t[0],t[1],t[2],t[3]),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}},{key:"bindAttributeValue",value:function(e,t){void 0!==t&&null!==t?"float4_fromAttr"===e.type?(this._gl.enableVertexAttribArray(e.location[0]),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.vertexData0),this._gl.vertexAttribPointer(e.location[0],4,this._gl.FLOAT,!1,0,0)):"float_fromAttr"===e.type&&(this._gl.enableVertexAttribArray(e.location[0]),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.vertexData0),this._gl.vertexAttribPointer(e.location[0],1,this._gl.FLOAT,!1,0,0)):this._gl.disableVertexAttribArray(e.location[0])}},{key:"bindSamplerValue",value:function(e,t,r){this._currentTextureUnit<16?this._gl.activeTexture(this._gl["TEXTURE"+this._currentTextureUnit]):this._gl.activeTexture(this._gl.TEXTURE16),void 0!==r&&null!==r?(this._gl.bindTexture(this._gl.TEXTURE_2D,r.textureData),0===this._bufferWidth&&(this._bufferWidth=r.W,this._gl.uniform1f(e,this._bufferWidth))):this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux),this._gl.uniform1i(t.location[0],this._currentTextureUnit),this._currentTextureUnit++}},{key:"bindUniformValue",value:function(e,t){void 0!==t&&null!==t&&("float"===e.type?t.constructor===Array?this._gl.uniform1fv(e.location[0],t):this._gl.uniform1f(e.location[0],t):"float4"===e.type?this._gl.uniform4f(e.location[0],t[0],t[1],t[2],t[3]):"mat4"===e.type&&this._gl.uniformMatrix4fv(e.location[0],!1,t))}},{key:"bindValue",value:function(e,t,r){switch(t.expectedMode){case"ATTRIBUTE":this.bindAttributeValue(t,r);break;case"SAMPLER":this.bindSamplerValue(e.uBufferWidth,t,r);break;case"UNIFORM":this.bindUniformValue(t,r)}}},{key:"bindFB",value:function(e,t){if(void 0!==e&&null!==e){if(void 0!==e[0]&&null!==e[0]){this._gl.viewport(0,0,e[0].W,e[0].H),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,!0===t?e[0].fBufferTemp:e[0].fBuffer);for(var r=[],i=0,l=e.length;i<l;i++)if(void 0!==e[i]&&null!==e[i]){var n=!0===t?e[i].textureDataTemp:e[i].textureData;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+i+"_WEBGL"],this._gl.TEXTURE_2D,n,0),r[i]=this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+i+"_WEBGL"]}else r[i]=this._gl.NONE;return this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(r),this.checkFramebufferStatus()}return this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),!0}return this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),!0}},{key:"enqueueNDRangeKernel",value:function(e,t,r,i){if(this._bufferWidth=0,this._gl.useProgram(e.kernel),!0===this.bindFB(t,r)){this._currentTextureUnit=0;for(var l in e.in_values)this.bindValue(e,e.in_values[l],i[l]);this._gl.enableVertexAttribArray(e.attr_VertexPos),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.vertexAttribPointer(e.attr_VertexPos,3,this._gl.FLOAT,!1,0,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0)}}},{key:"enqueueVertexFragmentProgram",value:function(e,t,r,i,l,n){this._bufferWidth=0,this._gl.useProgram(e.vertexFragmentProgram);var a=void 0!==r&&null!==r?r:4;if(!0===this.bindFB(i,l)&&void 0!==t&&null!==t){this._currentTextureUnit=0;for(var s in e.in_vertex_values)this.bindValue(e,e.in_vertex_values[s],n[s]);for(var o in e.in_fragment_values)this.bindValue(e,e.in_fragment_values[o],n[o]);"VERTEX_INDEX"===t.mode?(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.vertexData0),this._gl.drawElements(a,t.length,this._gl.UNSIGNED_SHORT,0)):this._gl.drawArrays(a,0,t.length)}}},{key:"readBuffer",value:function(e){void 0!==this.e&&null!==this.e&&(this.e.width=e.W,this.e.height=e.H),this._gl.useProgram(this.shader_readpixels),this._gl.viewport(0,0,e.W,e.H),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e.fBufferTemp),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL,this._gl.TEXTURE_2D,e.textureDataTemp,0);var t=[this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];if(this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(t),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,e.textureData),this._gl.uniform1i(this.sampler_buffer,0),this._gl.enableVertexAttribArray(this.attr_VertexPos),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.vertexAttribPointer(this.attr_VertexPos,3,e._supportFormat,!1,0,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0),void 0!==e.outArrayFloat&&null!==e.outArrayFloat||(e.outArrayFloat=new Float32Array(e.W*e.H*4)),this._gl.readPixels(0,0,e.W,e.H,this._gl.RGBA,this._gl.FLOAT,e.outArrayFloat),"FLOAT"===e.type){for(var r=new Float32Array(e.outArrayFloat.length/4),i=0,l=e.outArrayFloat.length/4;i<l;i++)r[i]=e.outArrayFloat[4*i];e.outArrayFloat=r}return e.outArrayFloat}}],[{key:"enqueueReadBuffer_WebGLTexture",value:function(e){return e.textureData}}]),e}();i.WebCLGL=f,t.exports.WebCLGL=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGLBuffer.class":2,"./WebCLGLKernel.class":4,"./WebCLGLUtils.class":5,"./WebCLGLVertexFragmentProgram.class":6}],2:[function(e,t,r){(function(e){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r.WebCLGLBuffer=function(){function e(t,r,l,n){i(this,e),this._gl=t,this.type=void 0!==r||null!==r?r:"FLOAT",this._supportFormat=this._gl.FLOAT,this.linear=void 0===l&&null===l||l,this.mode=void 0!==n||null!==n?n:"SAMPLER",this.W=null,this.H=null,this.textureData=null,this.textureDataTemp=null,this.vertexData0=null,this.fBuffer=null,this.renderBuffer=null,this.fBufferTemp=null,this.renderBufferTemp=null,"SAMPLER"===this.mode&&(this.textureData=this._gl.createTexture(),this.textureDataTemp=this._gl.createTexture()),"SAMPLER"!==this.mode&&"ATTRIBUTE"!==this.mode&&"VERTEX_INDEX"!==this.mode||(this.vertexData0=this._gl.createBuffer())}return l(e,[{key:"createFramebufferAndRenderbuffer",value:function(){var e=function(){var e=this._gl.createRenderbuffer();return this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,e),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this.W,this.H),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null),e}.bind(this);null!=this.fBuffer&&(this._gl.deleteFramebuffer(this.fBuffer),this._gl.deleteFramebuffer(this.fBufferTemp),this._gl.deleteRenderbuffer(this.renderBuffer),this._gl.deleteRenderbuffer(this.renderBufferTemp)),this.fBuffer=this._gl.createFramebuffer(),this.renderBuffer=e(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this.fBuffer),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this.renderBuffer),this.fBufferTemp=this._gl.createFramebuffer(),this.renderBufferTemp=e(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this.fBufferTemp),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this.renderBufferTemp)}},{key:"writeWebGLTextureBuffer",value:function(e,t){var r=function(e,t){!1===t||void 0===t||null===t?this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!1):this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!0),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this._gl.bindTexture(this._gl.TEXTURE_2D,e)}.bind(this),i=function(e){e instanceof HTMLImageElement?"FLOAT4"===this.type&&this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._supportFormat,e):this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this.W,this.H,0,this._gl.RGBA,this._supportFormat,e)}.bind(this),l=function(){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)}.bind(this);e instanceof WebGLTexture?(this.textureData=e,this.textureDataTemp=e):(r(this.textureData,t),i(e),l(),r(this.textureDataTemp,t),i(e),l()),this._gl.bindTexture(this._gl.TEXTURE_2D,null)}},{key:"writeBuffer",value:function(e,t,r){var i=function(e){if(!(e instanceof HTMLImageElement))if(this.length.constructor===Array?(this.length=this.length[0]*this.length[1],this.W=this.length[0],this.H=this.length[1]):(this.W=Math.ceil(Math.sqrt(this.length)),this.H=this.W),"FLOAT4"===this.type){e=e instanceof Float32Array?e:new Float32Array(e);var t=this.W*this.H*4;if(e.length!==t){for(var r=new Float32Array(t),i=0;i<t;i++)r[i]=null!=e[i]?e[i]:0;e=r}}else if("FLOAT"===this.type){for(var l=this.W*this.H*4,n=new Float32Array(l),a=0,s=this.W*this.H;a<s;a++){var o=4*a;n[o]=null!=e[a]?e[a]:0,n[o+1]=0,n[o+2]=0,n[o+3]=0}e=n}return e}.bind(this);void 0===r||null===r?e instanceof HTMLImageElement?this.length=e.width*e.height:this.length="FLOAT4"===this.type?e.length/4:e.length:this.length=[r[0],r[1]],"SAMPLER"===this.mode&&this.writeWebGLTextureBuffer(i(e),t),"SAMPLER"!==this.mode&&"ATTRIBUTE"!==this.mode||(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexData0),this._gl.bufferData(this._gl.ARRAY_BUFFER,e instanceof Float32Array?e:new Float32Array(e),this._gl.STATIC_DRAW)),"VERTEX_INDEX"===this.mode&&(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.vertexData0),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this._gl.STATIC_DRAW)),this.createFramebufferAndRenderbuffer()}},{key:"remove",value:function(){"SAMPLER"===this.mode&&(this._gl.deleteTexture(this.textureData),this._gl.deleteTexture(this.textureDataTemp)),"SAMPLER"!==this.mode&&"ATTRIBUTE"!==this.mode&&"VERTEX_INDEX"!==this.mode||this._gl.deleteBuffer(this.vertexData0),this._gl.deleteFramebuffer(this.fBuffer),this._gl.deleteFramebuffer(this.fBufferTemp),this._gl.deleteRenderbuffer(this.renderBuffer),this._gl.deleteRenderbuffer(this.renderBufferTemp)}}]),e}();e.WebCLGLBuffer=n,t.exports.WebCLGLBuffer=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,r){(function(i){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(){var e=new u,t=null;return arguments[0]instanceof WebGLRenderingContext?(t=arguments[0],e.setCtx(t),e._webCLGL=new s.WebCLGL(t),e.iniG(arguments),e):arguments[0]instanceof HTMLCanvasElement?(t=o.WebCLGLUtils.getWebGLContextFromCanvas(arguments[0]),e.setCtx(t),e._webCLGL=new s.WebCLGL(t),e.iniG(arguments),e):(t=o.WebCLGLUtils.getWebGLContextFromCanvas(document.createElement("canvas"),{antialias:!1}),e.setCtx(t),e._webCLGL=new s.WebCLGL(t),e.ini(arguments))}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGLFor=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();r.gpufor=n;var s=e("./WebCLGL.class"),o=e("./WebCLGLUtils.class"),u=r.WebCLGLFor=function(){function e(t){l(this,e),this.kernels={},this.vertexFragmentPrograms={},this._args={},this._argsValues={},this.calledArgs={},this._webCLGL=null,this._gl=null}return a(e,[{key:"defineOutputTempModes",value:function(e,t){for(var r=[],i=0;i<e.length;i++)r[i]=null!=e[i]&&function(e,t){var r=!1;for(var i in t)if("indices"!==i){var l=i.split(" ");if(l.length>0&&l[1]===e){r=!0;break}}return r}(e[i],t);return r}},{key:"prepareReturnCode",value:function(e,t){var r=[],i=e.match(new RegExp(/return.*$/gm)),l=(i=i[0].replace("return ","")).match(new RegExp(/\[/gm));if(null!=l&&l.length>=1){i=i.split("[")[1].split("]")[0];for(var n="",a=0,s=0;s<i.length;s++)","===i[s]&&0===a?(r.push(n),n=""):n+=i[s],"("===i[s]&&a++,")"===i[s]&&a--;r.push(n)}else r.push(i.replace(/;$/gm,""));for(var o="",u=0;u<t.length;u++){var f=!1;for(var h in this._args)if("indices"!==h){var _=h.split(" ");if(_[1]===t[u]){var g=_[0].match(new RegExp("float4","gm"));o+=null!=g&&g.length>0?"out"+u+"_float4 = "+r[u]+";\n":"out"+u+"_float = "+r[u]+";\n",f=!0;break}}!1===f&&(o+="out"+u+"_float4 = "+r[u]+";\n")}return o}},{key:"addKernel",value:function(e){var t=e.config,r=t[0],i=t[1]instanceof Array?t[1]:[t[1]],l=t[2],n=t[3],a=this._webCLGL.createKernel(),s=[];for(var o in this._args){var u=o.split(" ")[1];if(void 0!==u&&null!==u){var f=(l+n).match(new RegExp(u.replace(/\[\d.*/,""),"gm"));"indices"!==o&&null!=f&&f.length>0&&(a.in_values[u]={},s.push(o.replace("*attr ","* ").replace(/\[\d.*/,"")))}}n="void main("+s.toString()+") {vec2 "+r+" = get_global_id();"+n.replace(/return.*$/gm,this.prepareReturnCode(n,i))+"}",a.name=e.name,a.viewSource=null!=e.viewSource&&e.viewSource,a.setKernelSource(n,l),a.output=i,a.outputTempModes=this.defineOutputTempModes(i,this._args),a.enabled=!0,a.drawMode=null!=e.drawMode?e.drawMode:4,a.depthTest=null==e.depthTest||e.depthTest,a.blend=null!=e.blend&&e.blend,a.blendEquation=null!=e.blendEquation?e.blendEquation:"FUNC_ADD",a.blendSrcMode=null!=e.blendSrcMode?e.blendSrcMode:"SRC_ALPHA",a.blendDstMode=null!=e.blendDstMode?e.blendDstMode:"ONE_MINUS_SRC_ALPHA",this.kernels[Object.keys(this.kernels).length.toString()]=a}},{key:"addGraphic",value:function(e){var t=e.config,r=[null],i=void 0,l=void 0,n=void 0,a=void 0;5===t.length?(r=t[0]instanceof Array?t[0]:[t[0]],i=t[1],l=t[2],n=t[3],a=t[4]):(i=t[0],l=t[1],n=t[2],a=t[3]);var s=this._webCLGL.createVertexFragmentProgram(),o=[],u=[];for(var f in this._args){var h=f.split(" ")[1];if(void 0!==h&&null!==h){var _=(i+l).match(new RegExp(h.replace(/\[\d.*/,""),"gm"));"indices"!==f&&null!=_&&_.length>0&&(s.in_vertex_values[h]={},o.push(f.replace(/\[\d.*/,"")))}}for(var g in this._args){var c=g.split(" ")[1];if(void 0!==c&&null!==c){var d=(n+a).match(new RegExp(c.replace(/\[\d.*/,""),"gm"));"indices"!==g&&null!=d&&d.length>0&&(s.in_fragment_values[c]={},u.push(g.replace(/\[\d.*/,"")))}}l="void main("+o.toString()+") {"+l+"}",a="void main("+u.toString()+") {"+a.replace(/return.*$/gm,this.prepareReturnCode(a,r))+"}",s.name=e.name,s.viewSource=null!=e.viewSource&&e.viewSource,s.setVertexSource(l,i),s.setFragmentSource(a,n),s.output=r,s.outputTempModes=this.defineOutputTempModes(r,this._args),s.enabled=!0,s.drawMode=null!=e.drawMode?e.drawMode:4,s.depthTest=null==e.depthTest||e.depthTest,s.blend=null==e.blend||e.blend,s.blendEquation=null!=e.blendEquation?e.blendEquation:"FUNC_ADD",s.blendSrcMode=null!=e.blendSrcMode?e.blendSrcMode:"SRC_ALPHA",s.blendDstMode=null!=e.blendDstMode?e.blendDstMode:"ONE_MINUS_SRC_ALPHA",this.vertexFragmentPrograms[Object.keys(this.vertexFragmentPrograms).length.toString()]=s}},{key:"checkArg",value:function(e,t,r){var i=[],l=!1,n=!1;for(var a in t)for(var s in t[a].in_values){t[a].in_values[s];if(s===e){i.push(t[a]);break}}for(var o in r){for(var u in r[o].in_vertex_values){r[o].in_vertex_values[u];if(u===e){l=!0;break}}for(var f in r[o].in_fragment_values){r[o].in_fragment_values[f];if(f===e){n=!0;break}}}return{usedInVertex:l,usedInFragment:n,kernelPr:i}}},{key:"fillArg",value:function(e,t){this._webCLGL.fillBuffer(this._argsValues[e].textureData,t,this._argsValues[e].fBuffer),this._webCLGL.fillBuffer(this._argsValues[e].textureDataTemp,t,this._argsValues[e].fBufferTemp)}},{key:"getAllArgs",value:function(){return this._argsValues}},{key:"addArg",value:function(e){this._args[e]=null}},{key:"getGPUForArg",value:function(e,t){!1===this.calledArgs.hasOwnProperty(e)&&(this.calledArgs[e]=[]),-1===this.calledArgs[e].indexOf(t)&&this.calledArgs[e].push(t),!1===t.calledArgs.hasOwnProperty(e)&&(t.calledArgs[e]=[]),-1===t.calledArgs[e].indexOf(this)&&t.calledArgs[e].push(this);for(var r in t._args){var i=r.split(" ")[1];if(i===e){this._args[r]=t._args[r],this._argsValues[i]=t._argsValues[i];break}}}},{key:"setArg",value:function(e,t,r,i){if("indices"===e)this.setIndices(t);else for(var l in this._args){var n=l.split(" ")[1];if(void 0!==n&&n.replace(/\[\d.*/,"")===e){n!==e&&(e=n);var a=!1;if(null!=l.match(/\*/gm)){var s=this.checkArg(e,this.kernels,this.vertexFragmentPrograms),o="SAMPLER";!0===s.usedInVertex&&0===s.kernelPr.length&&!1===s.usedInFragment&&(o="ATTRIBUTE");var u=l.split("*")[0].toUpperCase();void 0!==i&&null!==i&&(u=i),void 0!==t&&null!==t?((!1===this._argsValues.hasOwnProperty(e)||!0===this._argsValues.hasOwnProperty(e)&&null==this._argsValues[e])&&(this._argsValues[e]=this._webCLGL.createBuffer(u,!1,o),this._argsValues[e].argument=e,a=!0),this._argsValues[e].writeBuffer(t,!1,r)):this._argsValues[e]=null}else void 0!==t&&null!==t&&(this._argsValues[e]=t),a=!0;if(!0===a&&!0===this.calledArgs.hasOwnProperty(e))for(var f=0;f<this.calledArgs[e].length;f++)this.calledArgs[e][f]._argsValues[e]=this._argsValues[e];break}}return t}},{key:"readArg",value:function(e){return this._webCLGL.readBuffer(this._argsValues[e])}},{key:"setIndices",value:function(e){this.CLGL_bufferIndices=this._webCLGL.createBuffer("FLOAT",!1,"VERTEX_INDEX"),this.CLGL_bufferIndices.writeBuffer(e)}},{key:"getCtx",value:function(){return this._webCLGL.getContext()}},{key:"setCtx",value:function(e){this._gl=e}},{key:"getWebCLGL",value:function(){return this._webCLGL}},{key:"onPreProcessKernel",value:function(e,t){this.kernels[e].onpre=t}},{key:"onPostProcessKernel",value:function(e,t){this.kernels[e].onpost=t}},{key:"enableKernel",value:function(e){this.kernels["0"|e.toString()].enabled=!0}},{key:"disableKernel",value:function(e){this.kernels["0"|e.toString()].enabled=!1}},{key:"getKernel",value:function(e){for(var t in this.kernels)if(t===e)return this.kernels[t];return null}},{key:"getAllKernels",value:function(){return this.kernels}},{key:"onPreProcessGraphic",value:function(e,t){this.vertexFragmentPrograms[e].onpre=t}},{key:"onPostProcessGraphic",value:function(e,t){this.vertexFragmentPrograms[e].onpost=t}},{key:"enableGraphic",value:function(e){this.vertexFragmentPrograms["0"|e.toString()].enabled=!0}},{key:"disableGraphic",value:function(e){this.vertexFragmentPrograms["0"|e.toString()].enabled=!1}},{key:"getVertexFragmentProgram",value:function(e){for(var t in this.vertexFragmentPrograms)if(t===e)return this.vertexFragmentPrograms[t];return null}},{key:"getAllVertexFragmentProgram",value:function(){return this.vertexFragmentPrograms}},{key:"processKernel",value:function(e,t,r){if(!0===e.enabled){if(void 0!==r&&null!==r&&!0===r&&(this.arrMakeCopy=[]),!0===e.depthTest?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),!0===e.blend?this._gl.enable(this._gl.BLEND):this._gl.disable(this._gl.BLEND),this._gl.blendFunc(this._gl[e.blendSrcMode],this._gl[e.blendDstMode]),this._gl.blendEquation(this._gl[e.blendEquation]),void 0!==e.onpre&&null!==e.onpre&&e.onpre(),void 0===t||null===t||!0===t){for(var i=!1,l=0;l<e.output.length;l++)if(null!=e.output[l]&&!0===e.outputTempModes[l]){i=!0;break}!0===i?(this._webCLGL.enqueueNDRangeKernel(e,o.WebCLGLUtils.getOutputBuffers(e,this._argsValues),!0,this._argsValues),this.arrMakeCopy.push(e)):this._webCLGL.enqueueNDRangeKernel(e,o.WebCLGLUtils.getOutputBuffers(e,this._argsValues),!1,this._argsValues)}else this._webCLGL.enqueueNDRangeKernel(e,o.WebCLGLUtils.getOutputBuffers(e,this._argsValues),!1,this._argsValues);void 0!==e.onpost&&null!==e.onpost&&e.onpost(),void 0!==r&&null!==r&&!0===r&&this.processCopies()}}},{key:"processCopies",value:function(e){for(var t=0;t<this.arrMakeCopy.length;t++)this._webCLGL.copy(this.arrMakeCopy[t],o.WebCLGLUtils.getOutputBuffers(this.arrMakeCopy[t],this._argsValues))}},{key:"processKernels",value:function(e){this.arrMakeCopy=[];for(var t in this.kernels)this.processKernel(this.kernels[t],e);this.processCopies()}},{key:"processGraphic",value:function(e){var t=[];for(var r in this.vertexFragmentPrograms){var i=this.vertexFragmentPrograms[r];if(!0===i.enabled){var l=void 0!==e&&null!==e||void 0===this.CLGL_bufferIndices||null===this.CLGL_bufferIndices?this._argsValues[e]:this.CLGL_bufferIndices;if(void 0!==l&&null!==l&&l.length>0){!0===i.depthTest?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),!0===i.blend?this._gl.enable(this._gl.BLEND):this._gl.disable(this._gl.BLEND),this._gl.blendFunc(this._gl[i.blendSrcMode],this._gl[i.blendDstMode]),this._gl.blendEquation(this._gl[i.blendEquation]),void 0!==i.onpre&&null!==i.onpre&&i.onpre();for(var n=!1,a=0;a<i.output.length;a++)if(null!=i.output[a]&&!0===i.outputTempModes[a]){n=!0;break}!0===n?(this._webCLGL.enqueueVertexFragmentProgram(i,l,i.drawMode,o.WebCLGLUtils.getOutputBuffers(i,this._argsValues),!0,this._argsValues),t.push(i)):this._webCLGL.enqueueVertexFragmentProgram(i,l,i.drawMode,o.WebCLGLUtils.getOutputBuffers(i,this._argsValues),!1,this._argsValues),void 0!==i.onpost&&null!==i.onpost&&i.onpost()}}}for(var s=0;s<t.length;s++)this._webCLGL.copy(t[s],o.WebCLGLUtils.getOutputBuffers(t[s],this._argsValues))}},{key:"ini",value:function(){var e=arguments[0],t=void 0,r=void 0,i=void 0;e.length>3?(this._args=e[0],t=e[1],r=e[2],i=e[3]):(this._args=e[0],t=e[1],r="FLOAT",i=e[2]);var l=0;for(var n in this._args){var a=this._args[n];this.setArg(n.split(" ")[1],a),0===l&&(a instanceof Array||a instanceof Float32Array||a instanceof Uint8Array||a instanceof HTMLImageElement)&&(l=a.length)}return"FLOAT"===r?this.addArg("float* result"):this.addArg("float4* result"),this.setArg("result",new Float32Array(l),null,r),this.addKernel({type:"KERNEL",name:"SIMPLE_KERNEL",viewSource:!1,config:[t,["result"],"",i]}),this.processKernels(),this._webCLGL.readBuffer(this._argsValues.result)}},{key:"iniG",value:function(){this._webCLGL.getContext().depthFunc(this._webCLGL.getContext().LEQUAL),this._webCLGL.getContext().clearDepth(1);var e=arguments[0];this._args=e[1];for(var t=2;t<e.length;t++)"KERNEL"===e[t].type?this.addKernel(e[t]):"GRAPHIC"===e[t].type&&this.addGraphic(e[t]);for(var r in this._args){var i=this._args[r];"indices"===r?null!==i&&this.setIndices(i):this.setArg(r.split(" ")[1],i)}}}]),e}();i.WebCLGLFor=u,t.exports.WebCLGLFor=u,i.gpufor=n,t.exports.gpufor=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGL.class":1,"./WebCLGLUtils.class":5}],4:[function(e,t,r){(function(i){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGLKernel=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e("./WebCLGLUtils.class"),s=r.WebCLGLKernel=function(){function e(t,r,i){l(this,e),this._gl=t;var n=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=0!==n.precision?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n";var a=this._gl.getExtension("WEBGL_draw_buffers");this._maxDrawBuffers=null,null!=a&&(this._maxDrawBuffers=this._gl.getParameter(a.MAX_DRAW_BUFFERS_WEBGL)),this.name="",this.enabled=!0,this.depthTest=null,this.blend=null,this.blendSrcMode=null,this.blendDstMode=null,this.blendEquation=null,this.onpre=null,this.onpost=null,this.viewSource=!1,this.in_values={},this.output=null,this.outputTempModes=null,this.fBuffer=null,this.fBufferTemp=null,this.fBufferLength=0,this.fBufferCount=0,void 0!==r&&null!==r&&this.setKernelSource(r,i)}return n(e,[{key:"setKernelSource",value:function(e,t){for(var r=function(){var e=this._precision+"attribute vec3 aVertexPosition;\nvarying vec2 global_id;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nglobal_id = aVertexPosition.xy*0.5+0.5;\n}\n",t="#extension GL_EXT_draw_buffers : require\n"+this._precision+a.WebCLGLUtils.lines_fragment_attrs(this.in_values)+"varying vec2 global_id;\nuniform float uBufferWidth;vec2 get_global_id() {\nreturn global_id;\n}\n"+a.WebCLGLUtils.get_global_id3_GLSLFunctionString()+a.WebCLGLUtils.get_global_id2_GLSLFunctionString()+this._head+"void main(void) {\n"+a.WebCLGLUtils.lines_drawBuffersInit(8)+this._source+a.WebCLGLUtils.lines_drawBuffersWrite(8)+"}\n";this.kernel=this._gl.createProgram();(new a.WebCLGLUtils).createShader(this._gl,"WEBCLGL",e,t,this.kernel);this.attr_VertexPos=this._gl.getAttribLocation(this.kernel,"aVertexPosition"),this.uBufferWidth=this._gl.getUniformLocation(this.kernel,"uBufferWidth");for(var r in this.in_values){var i={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float:"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_values[r].type];a.WebCLGLUtils.checkArgNameInitialization(this.in_values,r),this.in_values[r].location=[this._gl.getUniformLocation(this.kernel,r.replace(/\[\d.*/,""))],this.in_values[r].expectedMode=i}return"VERTEX PROGRAM\n"+e+"\n FRAGMENT PROGRAM\n"+t}.bind(this),i=e.split(")")[0].split("(")[1].split(","),l=0,n=i.length;l<n;l++)if(null!==i[l].match(/\*/gm)){var s=i[l].split("*")[1].trim();a.WebCLGLUtils.checkArgNameInitialization(this.in_values,s),null!=i[l].match(/float4/gm)?this.in_values[s].type="float4_fromSampler":null!=i[l].match(/float/gm)&&(this.in_values[s].type="float_fromSampler")}else if(""!==i[l]){var o=i[l].split(" ")[1].trim();for(var u in this.in_values)if(u.replace(/\[\d.*/,"")===o){o=u;break}a.WebCLGLUtils.checkArgNameInitialization(this.in_values,o),null!=i[l].match(/float4/gm)?this.in_values[o].type="float4":null!=i[l].match(/float/gm)?this.in_values[o].type="float":null!=i[l].match(/mat4/gm)&&(this.in_values[o].type="mat4")}this._head=void 0!==t&&null!==t?t:"",this._head=this._head.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._head=a.WebCLGLUtils.parseSource(this._head,this.in_values),this._source=e.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._source=this._source.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,""),this._source=a.WebCLGLUtils.parseSource(this._source,this.in_values);var f=r();!0===this.viewSource&&(console.log("%c KERNEL: "+this.name,"font-size: 20px; color: blue"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+t+e,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+f,"color: darkgray"))}}]),e}();i.WebCLGLKernel=s,t.exports.WebCLGLKernel=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGLUtils.class":5}],5:[function(e,t,r){(function(e){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=r.WebCLGLUtils=function(){function e(){i(this,e)}return l(e,[{key:"loadQuad",value:function(e,t,r){var i=void 0===t||null===t?.5:t,l=void 0===r||null===r?.5:r;this.vertexArray=[-i,-l,0,i,-l,0,i,l,0,-i,l,0],this.textureArray=[0,0,0,1,0,0,1,1,0,0,1,0],this.indexArray=[0,1,2,0,2,3];var n={};return n.vertexArray=this.vertexArray,n.textureArray=this.textureArray,n.indexArray=this.indexArray,n}},{key:"createShader",value:function(e,t,r,i,l){var n=!1,a=!1,s=function(t,r){console.log(t);for(var i=[],l=t.split("\n"),n=0,a=l.length;n<a;n++)if(null!=l[n].match(/^ERROR/gim)){var s=l[n].split(":"),o=parseInt(s[2]);i.push([o,l[n]])}var u=e.getShaderSource(r).split("\n");u.unshift("");for(var f=0,h=u.length;f<h;f++){for(var _=!1,g="",c=0,d=i.length;c<d;c++)if(f===i[c][0]){_=!0,g=i[c][1];break}!1===_?console.log("%c"+f+" %c"+u[f],"color:black","color:blue"):console.log("%c►►%c"+f+" %c"+u[f]+"\n%c"+g,"color:red","color:black","color:blue","color:red")}}.bind(this),o=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS))e.attachShader(l,o),n=!0;else{var u=e.getShaderInfoLog(o);console.log("%c"+t+" ERROR (vertex program)","color:red"),void 0!==u&&null!==u&&s(u,o)}var f=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(f,i),e.compileShader(f),e.getShaderParameter(f,e.COMPILE_STATUS))e.attachShader(l,f),a=!0;else{var h=e.getShaderInfoLog(f);console.log("%c"+t+" ERROR (fragment program)","color:red"),void 0!==h&&null!==h&&s(h,f)}if(!0===n&&!0===a){if(e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS))return!0;console.log("Error shader program "+t+":\n ");var _=e.getProgramInfoLog(l);return void 0!==_&&null!==_&&console.log(_),!1}return!1}},{key:"pack",value:function(e){var t=[1/255,1/255,1/255,0],r=e,i=this.fract(255*r),l=this.fract(255*i),n=[r,i,l,this.fract(255*l)],a=[n[1]*t[0],n[2]*t[1],n[3]*t[2],n[3]*t[3]];return[n[0]-a[0],n[1]-a[1],n[2]-a[2],n[3]-a[3]]}},{key:"unpack",value:function(e){var t=[1,1/255,1/65025,1/16581375];return this.dot4(e,t)}}],[{key:"getWebGLContextFromCanvas",value:function(e,t){var r=null;if(null==r)try{r=void 0===t||null===t?e.getContext("webgl"):e.getContext("webgl",t),console.log(null==r?"no webgl":"using webgl")}catch(e){r=null}if(null==r)try{r=void 0===t||null===t?e.getContext("experimental-webgl"):e.getContext("experimental-webgl",t),console.log(null==r?"no experimental-webgl":"using experimental-webgl")}catch(e){r=null}return null==r&&(r=!1),r}},{key:"getUint8ArrayFromHTMLImageElement",value:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height).data}},{key:"dot4",value:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}},{key:"fract",value:function(e){return e>0?e-Math.floor(e):e-Math.ceil(e)}},{key:"packGLSLFunctionString",value:function(){return"vec4 pack (float depth) {\nconst vec4 bias = vec4(1.0 / 255.0,\n1.0 / 255.0,\n1.0 / 255.0,\n0.0);\nfloat r = depth;\nfloat g = fract(r * 255.0);\nfloat b = fract(g * 255.0);\nfloat a = fract(b * 255.0);\nvec4 colour = vec4(r, g, b, a);\nreturn colour - (colour.yzww * bias);\n}\n"}},{key:"unpackGLSLFunctionString",value:function(){return"float unpack (vec4 colour) {\nconst vec4 bitShifts = vec4(1.0,\n1.0 / 255.0,\n1.0 / (255.0 * 255.0),\n1.0 / (255.0 * 255.0 * 255.0));\nreturn dot(colour, bitShifts);\n}\n"}},{key:"getOutputBuffers",value:function(e,t){var r=null;if(void 0!==e.output&&null!==e.output)if(r=[],null!=e.output[0])for(var i=0;i<e.output.length;i++)r[i]=t[e.output[i]];else r=null;return r}},{key:"parseSource",value:function(e,t){for(var r in t){var i=new RegExp(r+"\\[(?!\\d).*?\\]","gm"),l=e.match(i);if(null!=l)for(var n=0,a=l.length;n<a;n++){var s=new RegExp("```(s|\t)*gl.*"+l[n]+".*```[^```(s|\t)*gl]","gm");if(null==e.match(s)){var o=l[n].split("[")[0],u=l[n].split("[")[1].split("]")[0];e={float4_fromSampler:e.replace(o+"["+u+"]","texture2D("+o+","+u+")"),float_fromSampler:e.replace(o+"["+u+"]","texture2D("+o+","+u+").x"),float4_fromAttr:e.replace(o+"["+u+"]",o),float_fromAttr:e.replace(o+"["+u+"]",o)}[t[r].type]}}}return e=e.replace(/```(\s|\t)*gl/gi,"").replace(/```/gi,"").replace(/;/gi,";\n").replace(/}/gi,"}\n").replace(/{/gi,"{\n")}},{key:"lines_vertex_attrs",value:function(e){var t="";for(var r in e)t+={float4_fromSampler:"uniform sampler2D "+r+";",float_fromSampler:"uniform sampler2D "+r+";",float4_fromAttr:"attribute vec4 "+r+";",float_fromAttr:"attribute float "+r+";",float:"uniform float "+r+";",float4:"uniform vec4 "+r+";",mat4:"uniform mat4 "+r+";"}[e[r].type]+"\n";return t}},{key:"lines_fragment_attrs",value:function(e){var t="";for(var r in e)t+={float4_fromSampler:"uniform sampler2D "+r+";",float_fromSampler:"uniform sampler2D "+r+";",float:"uniform float "+r+";",float4:"uniform vec4 "+r+";",mat4:"uniform mat4 "+r+";"}[e[r].type]+"\n";return t}},{key:"lines_drawBuffersInit",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="float out"+r+"_float = -999.99989;\nvec4 out"+r+"_float4;\n";return t}},{key:"lines_drawBuffersWriteInit",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="layout(location = "+r+") out vec4 outCol"+r+";\n";return t}},{key:"lines_drawBuffersWrite",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="if(out"+r+"_float != -999.99989) gl_FragData["+r+"] = vec4(out"+r+"_float,0.0,0.0,1.0);\n else gl_FragData["+r+"] = out"+r+"_float4;\n";return t}},{key:"checkArgNameInitialization",value:function(e,t){!1===e.hasOwnProperty(t)&&(e[t]={type:null,expectedMode:null,location:null})}},{key:"get_global_id3_GLSLFunctionString",value:function(){return"vec2 get_global_id(float id, float bufferWidth, float geometryLength) {\nfloat texelSize = 1.0/bufferWidth;float num = (id*geometryLength)/bufferWidth;float column = fract(num)+(texelSize/2.0);float row = (floor(num)/bufferWidth)+(texelSize/2.0);return vec2(column, row);}\n"}},{key:"get_global_id2_GLSLFunctionString",value:function(){return"vec2 get_global_id(vec2 id, float bufferWidth) {\nfloat texelSize = 1.0/bufferWidth;float column = (id.x/bufferWidth)+(texelSize/2.0);float row = (id.y/bufferWidth)+(texelSize/2.0);return vec2(column, row);}\n"}}]),e}();e.WebCLGLUtils=n,t.exports.WebCLGLUtils=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){(function(i){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGLVertexFragmentProgram=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e("./WebCLGLUtils.class"),s=r.WebCLGLVertexFragmentProgram=function(){function e(t,r,i,n,a){l(this,e),this._gl=t;var s=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=0!==s.precision?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n";var o=this._gl.getExtension("WEBGL_draw_buffers");this._maxDrawBuffers=null,null!=o&&(this._maxDrawBuffers=this._gl.getParameter(o.MAX_DRAW_BUFFERS_WEBGL)),this.name="",this.viewSource=!1,this.in_vertex_values={},this.in_fragment_values={},this._vertexP_ready=!1,this._fragmentP_ready=!1,this._vertexHead=null,this._vertexSource=null,this._fragmentHead=null,this._fragmentSource=null,this.output=null,this.outputTempModes=null,this.fBuffer=null,this.fBufferTemp=null,this.drawMode=4,void 0!==r&&null!==r&&this.setVertexSource(r,i),void 0!==n&&null!==n&&this.setFragmentSource(n,a)}return n(e,[{key:"compileVertexFragmentSource",value:function(){var e=this._precision+"uniform float uOffset;\nuniform float uBufferWidth;"+a.WebCLGLUtils.lines_vertex_attrs(this.in_vertex_values)+a.WebCLGLUtils.unpackGLSLFunctionString()+a.WebCLGLUtils.get_global_id3_GLSLFunctionString()+a.WebCLGLUtils.get_global_id2_GLSLFunctionString()+this._vertexHead+"void main(void) {\n"+this._vertexSource+"}\n",t="#extension GL_EXT_draw_buffers : require\n"+this._precision+a.WebCLGLUtils.lines_fragment_attrs(this.in_fragment_values)+a.WebCLGLUtils.get_global_id3_GLSLFunctionString()+a.WebCLGLUtils.get_global_id2_GLSLFunctionString()+this._fragmentHead+"void main(void) {\n"+a.WebCLGLUtils.lines_drawBuffersInit(8)+this._fragmentSource+a.WebCLGLUtils.lines_drawBuffersWrite(8)+"}\n";this.vertexFragmentProgram=this._gl.createProgram();(new a.WebCLGLUtils).createShader(this._gl,"WEBCLGL VERTEX FRAGMENT PROGRAM",e,t,this.vertexFragmentProgram);this.uOffset=this._gl.getUniformLocation(this.vertexFragmentProgram,"uOffset"),this.uBufferWidth=this._gl.getUniformLocation(this.vertexFragmentProgram,"uBufferWidth");for(var r in this.in_vertex_values){var i={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float4_fromAttr:"ATTRIBUTE",float_fromAttr:"ATTRIBUTE",float:"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_vertex_values[r].type];a.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,r);var l="ATTRIBUTE"===i?this._gl.getAttribLocation(this.vertexFragmentProgram,r):this._gl.getUniformLocation(this.vertexFragmentProgram,r.replace(/\[\d.*/,""));this.in_vertex_values[r].location=[l],this.in_vertex_values[r].expectedMode=i}for(var n in this.in_fragment_values){var s={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float:"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_fragment_values[n].type];a.WebCLGLUtils.checkArgNameInitialization(this.in_fragment_values,n),this.in_fragment_values[n].location=[this._gl.getUniformLocation(this.vertexFragmentProgram,n.replace(/\[\d.*/,""))],this.in_fragment_values[n].expectedMode=s}return"VERTEX PROGRAM\n"+e+"\n FRAGMENT PROGRAM\n"+t}},{key:"setVertexSource",value:function(e,t){for(var r=e.split(")")[0].split("(")[1].split(","),i=0,l=r.length;i<l;i++)if(null!==r[i].match(/\*attr/gm)){var n=r[i].split("*attr")[1].trim();a.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,n),null!=r[i].match(/float4/gm)?this.in_vertex_values[n].type="float4_fromAttr":null!=r[i].match(/float/gm)&&(this.in_vertex_values[n].type="float_fromAttr")}else if(null!==r[i].match(/\*/gm)){var s=r[i].split("*")[1].trim();a.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,s),null!=r[i].match(/float4/gm)?this.in_vertex_values[s].type="float4_fromSampler":null!=r[i].match(/float/gm)&&(this.in_vertex_values[s].type="float_fromSampler")}else if(""!==r[i]){var o=r[i].split(" ")[1].trim();for(var u in this.in_vertex_values)if(u.replace(/\[\d.*/,"")===o){o=u;break}a.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,o),null!=r[i].match(/float4/gm)?this.in_vertex_values[o].type="float4":null!=r[i].match(/float/gm)?this.in_vertex_values[o].type="float":null!=r[i].match(/mat4/gm)&&(this.in_vertex_values[o].type="mat4")}if(this._vertexHead=void 0!==t&&null!==t?t:"",this._vertexHead=this._vertexHead.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._vertexHead=a.WebCLGLUtils.parseSource(this._vertexHead,this.in_vertex_values),this._vertexSource=e.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._vertexSource=this._vertexSource.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,""),this._vertexSource=a.WebCLGLUtils.parseSource(this._vertexSource,this.in_vertex_values),this._vertexP_ready=!0,!0===this._fragmentP_ready){var f=this.compileVertexFragmentSource();!0===this.viewSource&&(console.log("%c VFP: "+this.name,"font-size: 20px; color: green"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+t+e,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+f,"color: darkgray"))}}},{key:"setFragmentSource",value:function(e,t){for(var r=e.split(")")[0].split("(")[1].split(","),i=0,l=r.length;i<l;i++)if(null!==r[i].match(/\*/gm)){var n=r[i].split("*")[1].trim();a.WebCLGLUtils.checkArgNameInitialization(this.in_fragment_values,n),null!=r[i].match(/float4/gm)?this.in_fragment_values[n].type="float4_fromSampler":null!=r[i].match(/float/gm)&&(this.in_fragment_values[n].type="float_fromSampler")}else if(""!==r[i]){var s=r[i].split(" ")[1].trim();for(var o in this.in_fragment_values)if(o.replace(/\[\d.*/,"")===s){s=o;break}a.WebCLGLUtils.checkArgNameInitialization(this.in_fragment_values,s),null!=r[i].match(/float4/gm)?this.in_fragment_values[s].type="float4":null!=r[i].match(/float/gm)?this.in_fragment_values[s].type="float":null!=r[i].match(/mat4/gm)&&(this.in_fragment_values[s].type="mat4")}if(this._fragmentHead=void 0!==t&&null!==t?t:"",this._fragmentHead=this._fragmentHead.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._fragmentHead=a.WebCLGLUtils.parseSource(this._fragmentHead,this.in_fragment_values),this._fragmentSource=e.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._fragmentSource=this._fragmentSource.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,""),this._fragmentSource=a.WebCLGLUtils.parseSource(this._fragmentSource,this.in_fragment_values),this._fragmentP_ready=!0,!0===this._vertexP_ready){var u=this.compileVertexFragmentSource();!0===this.viewSource&&(console.log("%c VFP: ","font-size: 20px; color: green"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+t+e,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+u,"color: darkgray"))}}}]),e}();i.WebCLGLVertexFragmentProgram=s,t.exports.WebCLGLVertexFragmentProgram=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGLUtils.class":5}],7:[function(e,t,r){(function(r){"use strict";e("./WebCLGL.class"),e("./WebCLGLBuffer.class"),e("./WebCLGLFor.class"),e("./WebCLGLKernel.class"),e("./WebCLGLUtils.class"),e("./WebCLGLVertexFragmentProgram.class"),t.exports.WebCLGL=r.WebCLGL=WebCLGL,t.exports.WebCLGLBuffer=r.WebCLGLBuffer=WebCLGLBuffer,t.exports.WebCLGLFor=r.WebCLGLFor=WebCLGLFor,t.exports.WebCLGLKernel=r.WebCLGLKernel=WebCLGLKernel,t.exports.WebCLGLUtils=r.WebCLGLUtils=WebCLGLUtils,t.exports.WebCLGLVertexFragmentProgram=r.WebCLGLVertexFragmentProgram=WebCLGLVertexFragmentProgram}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGL.class":1,"./WebCLGLBuffer.class":2,"./WebCLGLFor.class":3,"./WebCLGLKernel.class":4,"./WebCLGLUtils.class":5,"./WebCLGLVertexFragmentProgram.class":6}]},{},[7]);